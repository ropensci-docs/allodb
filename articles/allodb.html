<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="allodb">
<title>Using allodb to estimate aboveground biomass • allodb</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using allodb to estimate aboveground biomass">
<meta property="og:description" content="allodb">
<meta property="og:image" content="https://docs.ropensci.org/allodb/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">allodb</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="active nav-item">
  <a class="nav-link" href="../articles/allodb.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/allodb/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Using allodb to estimate aboveground biomass</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/allodb/blob/HEAD/vignettes/allodb.Rmd" class="external-link"><code>vignettes/allodb.Rmd</code></a></small>
      <div class="d-none name"><code>allodb.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install the development version of <em>allodb</em> from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"ropensci/allodb"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-the-census-data">Load the census data<a class="anchor" aria-label="anchor" href="#load-the-census-data"></a>
</h2>
<p>Prior to calculating tree biomass using <em>allodb</em>, users need to provide a table (i.e. dataframe) with DBH (cm), parsed species Latin names, and site(s) coordinates. In the following examples we use data from the Smithsonian Conservation Biology Institute, USA (SCBI) ForestGEO dynamics plot (1st census in 2008, trees from 1 hectare). Data can be requested through the ForestGEO portal (<a href="https://forestgeo.si.edu/" class="external-link uri">https://forestgeo.si.edu/</a>)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/allodb/">allodb</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: allodb</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">scbi_stem1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">scbi_stem1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Classes 'tbl_df', 'tbl' and 'data.frame':    2287 obs. of  6 variables:</span></span>
<span><span class="co">#&gt;  $ treeID : int  2695 1229 1230 1295 1229 66 2600 4936 1229 1005 ...</span></span>
<span><span class="co">#&gt;  $ stemID : int  2695 38557 1230 32303 32273 31258 2600 4936 36996 1005 ...</span></span>
<span><span class="co">#&gt;  $ dbh    : num  1.41 1.67 1.42 1.04 2.47 ...</span></span>
<span><span class="co">#&gt;  $ genus  : chr  "Acer" "Acer" "Acer" "Acer" ...</span></span>
<span><span class="co">#&gt;  $ species: chr  "negundo" "negundo" "negundo" "negundo" ...</span></span>
<span><span class="co">#&gt;  $ Family : chr  "Sapindaceae" "Sapindaceae" "Sapindaceae" "Sapindaceae" ...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-and-modify-the-equation-table">Load and modify the equation table<a class="anchor" aria-label="anchor" href="#load-and-modify-the-equation-table"></a>
</h2>
<p><code>allodb</code> provides a dataframe containing 570 parsed allometric equations.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">equations</span><span class="op">)</span></span></code></pre></div>
<p>Additional information about the equation table can be found in the equation metadata.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">equations_metadata</span><span class="op">)</span></span></code></pre></div>
<p>This equation table is the default in all functions of the package. Users can modify the set of equations that will be used to estimate biomass using the <code><a href="../reference/new_equations.html">new_equations()</a></code> function: users can work on a subset of those equations, or add new equations to the table (see <code><a href="../reference/new_equations.html">?allodb::new_equations</a></code>). The customized equation table should be provided as an argument in the <code><a href="../reference/get_biomass.html">get_biomass()</a></code> (or other) function (argument name: <code>new_eqtable</code>).</p>
<div class="section level3">
<h3 id="subset-the-equation-table">Subset the equation table<a class="anchor" aria-label="anchor" href="#subset-the-equation-table"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">show_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"equation_id"</span>, <span class="st">"equation_taxa"</span>, <span class="st">"equation_allometry"</span><span class="op">)</span></span>
<span><span class="va">eq_tab_acer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_equations.html">new_equations</a></span><span class="op">(</span>subset_taxa <span class="op">=</span> <span class="st">"Acer"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">eq_tab_acer</span><span class="op">[</span>, <span class="va">show_cols</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   equation_id equation_taxa       equation_allometry                            </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> a4e4d1      Acer saccharum      exp(-2.192-0.011*dbh+2.67*(log(dbh)))         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> dfc2c7      Acer rubrum         2.02338*(dbh^2)^1.27612                       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> eac63e      Acer rubrum         5.2879*(dbh^2)^1.07581                        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> f49bcb      Acer pseudoplatanus exp(-5.644074+(2.5189*(log(pi*dbh))))         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 14bf3d      Acer mandshuricum   0.0335*(dbh)^1.606+0.0026*(dbh)^3.323+0.1222*…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 0c7cd6      Acer mono           0.0202*(dbh)^1.810+0.0111*(dbh)^2.740+0.1156*…</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="add-new-equations">Add new equations<a class="anchor" aria-label="anchor" href="#add-new-equations"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eq_tab_add</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_equations.html">new_equations</a></span><span class="op">(</span></span>
<span>  new_taxa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Quercus ilex"</span>, <span class="st">"Castanea sativa"</span><span class="op">)</span>,</span>
<span>  new_allometry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0.12*dbh^2.5"</span>, <span class="st">"0.15*dbh^2.7"</span><span class="op">)</span>,</span>
<span>  new_coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">44</span><span class="op">)</span>,</span>
<span>  new_min_dbh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  new_max_dbh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">35</span>, <span class="fl">68</span><span class="op">)</span>,</span>
<span>  new_sample_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">143</span>, <span class="fl">62</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## show added equations - they contain "new" in their equation_id</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">eq_tab_add</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"new"</span>, <span class="va">eq_tab_add</span><span class="op">$</span><span class="va">equation_id</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 15</span></span></span>
<span><span class="co">#&gt;   equation_id equation_taxa   equation_allometry independent_variable</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> new1        Quercus ilex    0.12*dbh^2.5       DBH                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> new2        Castanea sativa 0.15*dbh^2.7       DBH                 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 11 more variables: dependent_variable &lt;chr&gt;, long &lt;chr&gt;, lat &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   koppen &lt;chr&gt;, dbh_min_cm &lt;dbl&gt;, dbh_max_cm &lt;dbl&gt;, sample_size &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   dbh_units_original &lt;chr&gt;, dbh_unit_cf &lt;dbl&gt;, output_units_original &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   output_units_cf &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="estimate-the-aboveground-biomass">Estimate the aboveground biomass<a class="anchor" aria-label="anchor" href="#estimate-the-aboveground-biomass"></a>
</h2>
<p>The aboveground biomass (AGB) can be estimated using the <code><a href="../reference/get_biomass.html">get_biomass()</a></code> function: the required arguments are the diameter at breast height (DBH, in cm), the taxonomic identification (to the genus or species level), and the location (long-lat coordinates). The output is the aboveground biomass of the tree in kg.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_biomass.html">get_biomass</a></span><span class="op">(</span></span>
<span>  dbh <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  genus <span class="op">=</span> <span class="st">"liriodendron"</span>,</span>
<span>  species <span class="op">=</span> <span class="st">"tulipifera"</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">78.2</span>, <span class="fl">38.9</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1578.644</span></span></code></pre></div>
<p>The <code><a href="../reference/get_biomass.html">get_biomass()</a></code> function can also be used to estimate the AGB of all trees in one (or several) censuses.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scbi_stem1</span><span class="op">$</span><span class="va">agb</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/get_biomass.html">get_biomass</a></span><span class="op">(</span></span>
<span>    dbh <span class="op">=</span> <span class="va">scbi_stem1</span><span class="op">$</span><span class="va">dbh</span>,</span>
<span>    genus <span class="op">=</span> <span class="va">scbi_stem1</span><span class="op">$</span><span class="va">genus</span>,</span>
<span>    species <span class="op">=</span> <span class="va">scbi_stem1</span><span class="op">$</span><span class="va">species</span>,</span>
<span>    coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">78.2</span>, <span class="fl">38.9</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">scbi_stem1</span><span class="op">$</span><span class="va">dbh</span>,</span>
<span>  y <span class="op">=</span> <span class="va">scbi_stem1</span><span class="op">$</span><span class="va">agb</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">scbi_stem1</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"DBH (cm)"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"AGB (kg)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="allodb_files/figure-html/plot-agb-scbi-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="how-agb-is-estimated">How AGB is estimated<a class="anchor" aria-label="anchor" href="#how-agb-is-estimated"></a>
</h2>
<div class="section level3">
<h3 id="attribute-a-weight-to-each-equation-in-the-equation-table-for-each-taxonlocation-combination">Attribute a weight to each equation in the equation table for each taxon/location combination<a class="anchor" aria-label="anchor" href="#attribute-a-weight-to-each-equation-in-the-equation-table-for-each-taxonlocation-combination"></a>
</h3>
<p>Within the <code><a href="../reference/get_biomass.html">get_biomass()</a></code> function, new allometric equations are calibrated for each taxon/location combinations in the user-provided dataframe. This is done by attributing a weight to each equation in the equation table, based on its sampling size, and taxonomic and climatic similarity with the taxon/location combination considered.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">allom_weights</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/weight_allom.html">weight_allom</a></span><span class="op">(</span></span>
<span>    genus <span class="op">=</span> <span class="st">"Acer"</span>,</span>
<span>    species <span class="op">=</span> <span class="st">"rubrum"</span>,</span>
<span>    coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">78</span>, <span class="fl">38</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">## visualize weights</span></span>
<span><span class="va">equ_tab_acer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_equations.html">new_equations</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">equ_tab_acer</span><span class="op">$</span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">allom_weights</span></span>
<span><span class="va">keep_cols</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"equation_id"</span>,</span>
<span>    <span class="st">"equation_taxa"</span>,</span>
<span>    <span class="st">"sample_size"</span>,</span>
<span>    <span class="st">"weights"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">order_weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">equ_tab_acer</span><span class="op">$</span><span class="va">weights</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">equ_tab_acer</span> <span class="op">&lt;-</span> <span class="va">equ_tab_acer</span><span class="op">[</span><span class="va">order_weights</span>, <span class="va">keep_cols</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">equ_tab_acer</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   equation_id equation_taxa        sample_size weights</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 138258      Acer rubrum                  150   0.415</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> d6be5c      Sapindaceae                  243   0.383</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> a2fbbb      Sapindaceae                  200   0.349</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2630d5      Trees (Angiosperms)          886   0.299</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> d4c590      Trees (Angiosperms)          549   0.289</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ed748f      Broad-leaved species        <span style="text-decoration: underline;">2</span>223   0.270</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="resample-equations">Resample equations<a class="anchor" aria-label="anchor" href="#resample-equations"></a>
</h3>
<p>Equations are then resampled within their original DBH range: the number of resampled values for each equation is proportional to its weight (as attributed by the <code><a href="../reference/weight_allom.html">weight_allom()</a></code> function).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_resample</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/resample_agb.html">resample_agb</a></span><span class="op">(</span></span>
<span>    genus <span class="op">=</span> <span class="st">"Acer"</span>,</span>
<span>    species <span class="op">=</span> <span class="st">"rubrum"</span>,</span>
<span>    coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">78</span>, <span class="fl">38</span><span class="op">)</span>,</span>
<span>    nres <span class="op">=</span> <span class="fl">1e4</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">df_resample</span><span class="op">$</span><span class="va">dbh</span>,</span>
<span>  <span class="va">df_resample</span><span class="op">$</span><span class="va">agb</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"DBH (cm)"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Resampled AGB values (kg)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="allodb_files/figure-html/resample-acer-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="calibrate-a-new-equation-for-each-taxonlocation-combination">Calibrate a new equation for each taxon/location combination<a class="anchor" aria-label="anchor" href="#calibrate-a-new-equation-for-each-taxonlocation-combination"></a>
</h3>
<p>The resampled values are then used to fit the following nonlinear model: <span class="math inline">\(AGB = a \cdot dbh ^ b + e\)</span>, with i.i.d. <span class="math inline">\(e \sim \mathcal{N}(0, sigma^2)\)</span>. The parameters (<em>a</em>, <em>b</em>, and <em>sigma</em>) are returned by the <code><a href="../reference/est_params.html">est_params()</a></code> function. In other words, this function calibrates new allometric equations from sampling previous ones. New allometric equations are calibrated for each species and location by resampling the original compiled equations; equations with a larger sample size, and/or higher taxonomic rank, and climatic similarity with the species and location in question are given a higher weight in this process.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pars_acer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/est_params.html">est_params</a></span><span class="op">(</span></span>
<span>  genus <span class="op">=</span> <span class="st">"Acer"</span>,</span>
<span>  species <span class="op">=</span> <span class="st">"rubrum"</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">78</span>, <span class="fl">38</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">df_resample</span><span class="op">$</span><span class="va">dbh</span>,</span>
<span>  <span class="va">df_resample</span><span class="op">$</span><span class="va">agb</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"DBH (cm)"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Resampled AGB values (kg)"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="va">pars_acer</span><span class="op">$</span><span class="va">a</span> <span class="op">*</span> <span class="va">x</span><span class="op">^</span><span class="va">pars_acer</span><span class="op">$</span><span class="va">b</span>,</span>
<span>  add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="allodb_files/figure-html/est-params-acer-1.png" width="576"></p>
<p>The <code><a href="../reference/est_params.html">est_params()</a></code> function can be used for all species/site combinations in the dataset at once.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/est_params.html">est_params</a></span><span class="op">(</span></span>
<span>  genus <span class="op">=</span> <span class="va">scbi_stem1</span><span class="op">$</span><span class="va">genus</span>,</span>
<span>  species <span class="op">=</span> <span class="va">scbi_stem1</span><span class="op">$</span><span class="va">species</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">78.2</span>, <span class="fl">38.9</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   genus       species      long   lat      a     b sigma</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Acer        negundo     -<span style="color: #BB0000;">78.2</span>  38.9 0.076<span style="text-decoration: underline;">2</span>  2.55  433.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Acer        rubrum      -<span style="color: #BB0000;">78.2</span>  38.9 0.076<span style="text-decoration: underline;">8</span>  2.55  412.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Ailanthus   altissima   -<span style="color: #BB0000;">78.2</span>  38.9 0.099<span style="text-decoration: underline;">5</span>  2.48  377.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Amelanchier arborea     -<span style="color: #BB0000;">78.2</span>  38.9 0.069<span style="text-decoration: underline;">0</span>  2.56  359.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Asimina     triloba     -<span style="color: #BB0000;">78.2</span>  38.9 0.099<span style="text-decoration: underline;">5</span>  2.48  377.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Carpinus    caroliniana -<span style="color: #BB0000;">78.2</span>  38.9 0.098<span style="text-decoration: underline;">4</span>  2.48  317.</span></span></code></pre></div>
<p>AGB is then recalculated as <code>AGB = a * dbh^b</code> within the <code><a href="../reference/get_biomass.html">get_biomass()</a></code> function.</p>
</div>
</div>
<div class="section level2">
<h2 id="visualize-the-recalibration-of-equations">Visualize the recalibration of equations<a class="anchor" aria-label="anchor" href="#visualize-the-recalibration-of-equations"></a>
</h2>
<p>The recalibrated equation for one taxon/location combination can be easily visualized with the <code><a href="../reference/illustrate_allodb.html">illustrate_allodb()</a></code> function, which returns a ggplot (see package <code>ggplot2</code>) with all resampled values, and the top equations used displayed in the legend. The user can control the number of equations and equation information shown in the legend. The red dotted line is the recalibrated equation used in the <code><a href="../reference/get_biomass.html">get_biomass()</a></code> function.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/illustrate_allodb.html">illustrate_allodb</a></span><span class="op">(</span></span>
<span>  genus <span class="op">=</span> <span class="st">"Acer"</span>,</span>
<span>  species <span class="op">=</span> <span class="st">"rubrum"</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">78</span>, <span class="fl">38</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="allodb_files/figure-html/illustrate-allodb-1.png" width="768"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/illustrate_allodb.html">illustrate_allodb</a></span><span class="op">(</span></span>
<span>  genus <span class="op">=</span> <span class="st">"Acer"</span>,</span>
<span>  species <span class="op">=</span> <span class="st">"rubrum"</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">78</span>, <span class="fl">38</span><span class="op">)</span>,</span>
<span>  neq <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  eqinfo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"equation_taxa"</span>, <span class="st">"geographic_area"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="allodb_files/figure-html/illustrate-allodb2-1.png" width="960"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
